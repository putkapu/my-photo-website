---
import BaseLayout from '../../layouts/BaseLayout.astro'
import PostCard from '../../components/PostCard.astro'
import { getCollection } from 'astro:content'

export async function getStaticPaths() {
  const posts = await getCollection('posts')
  const uniqueTags = [...new Set(posts.map(post => post.data.tag))]
  
  return uniqueTags.map(tag => ({
    params: { tag },
    props: { 
      tag,
      posts: posts
        .filter(post => post.data.tag === tag)
        .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
    }
  }))
}

const { tag, posts } = Astro.props
---

<BaseLayout title={`${tag} - Ruan Putka`}>
  <header class="tag-header">
    <a href="/" class="back-link">&larr; All posts</a>
    <h1>#{tag}</h1>
    <p class="post-count">{posts.length} post{posts.length !== 1 ? 's' : ''}</p>
  </header>
  
  <ul class="post-list">
    {posts.map((post) => (
      <li>
        <PostCard 
          title={post.data.title}
          slug={post.slug}
          date={post.data.date}
          tag={post.data.tag}
        />
      </li>
    ))}
  </ul>
</BaseLayout>

<style>
  .tag-header {
    margin-bottom: 2rem;
  }

  .back-link {
    display: inline-block;
    margin-bottom: 1rem;
    color: var(--secondary-text);
    font-size: 0.9rem;
  }

  .back-link:hover {
    color: var(--accent-color);
  }

  .tag-header h1 {
    margin-bottom: 0.25rem;
  }

  .post-count {
    color: var(--secondary-text);
    font-size: 0.9rem;
    margin: 0;
  }
</style>
